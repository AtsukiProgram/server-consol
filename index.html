<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>サーバーコンソール</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="logo.png" alt="LOGO" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div class="logo-placeholder" style="display:none;">LOGO</div>
            </div>

            <!-- Desktop Navigation -->
            <nav class="nav-desktop">
                <button class="nav-btn active" data-tab="server">サーバー</button>
                <button class="nav-btn" data-tab="settings">設定</button>
                <button class="nav-btn" data-tab="account">アカウント</button>
            </nav>

            <!-- Mobile Navigation Toggle -->
            <button class="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>

        <!-- Mobile Navigation Menu -->
        <nav class="nav-mobile hidden">
            <button class="nav-btn active" data-tab="server">サーバー</button>
            <button class="nav-btn" data-tab="settings">設定</button>
            <button class="nav-btn" data-tab="account">アカウント</button>
        </nav>
    </header>

    <!-- Alert Banner -->
    <div class="alert alert-error hidden" id="connectionAlert">
        フォルダに接続できませんでした
    </div>

    <!-- 起動ファイル選択モーダル -->
    <div id="startupFileModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>起動ファイルを選択</h3>
                <button class="modal-close" onclick="closeStartupFileModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="startup-file-filter">
                    <label>ファイルタイプ:</label>
                    <select id="fileTypeFilter" onchange="filterStartupFiles()">
                        <option value="all">すべて</option>
                        <option value="jar">JAR ファイル (.jar)</option>
                        <option value="exe">実行ファイル (.exe)</option>
                        <option value="bat">バッチファイル (.bat)</option>
                        <option value="sh">シェルスクリプト (.sh)</option>
                    </select>
                </div>
                <div class="startup-file-browser" id="startupFileBrowser">
                    <!-- ファイル一覧がここに表示される -->
                </div>
                <div class="selected-file-info">
                    <strong>選択中:</strong> <span id="selectedFileDisplay">未選択</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="confirmStartupFileSelection()" disabled id="confirmStartupBtn">選択</button>
                <button class="btn btn-secondary" onclick="closeStartupFileModal()">キャンセル</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- SERVER Tab -->
        <div class="tab-content active" id="server-tab">
            <div class="server-view" id="serverFolderView">
                <div class="folder-grid">
                    <!-- サーバーフォルダがここに表示される -->
                </div>
            </div>

            <!-- Server Detail View -->
            <div class="server-detail hidden" id="serverDetailView">
                <div class="server-detail-header">
                    <button class="btn btn-back" onclick="goBackToFolders()">← 戻る</button>
                    <h2 id="serverDetailTitle">Server Name</h2>
                    <div class="server-status" id="serverDetailStatus">停止中</div>
                </div>

                <div class="server-detail-content">
                    <div class="server-console">
                        <div class="console-header">コンソール</div>
                        <div class="console-content" id="serverConsole"></div>
                        <div class="console-input">
                            <input type="text" id="consoleCommandInput" placeholder="コマンドを入力..." disabled>
                            <button onclick="sendConsoleCommand()" disabled id="sendCommandBtn">送信</button>
                        </div>
                    </div>

                    <div class="server-controls">
                        <div class="startup-file-info">
                            <strong>起動ファイル:</strong> 
                            <span id="currentStartupFile">未設定</span>
                            <button class="btn btn-small btn-secondary" onclick="changeStartupFile()">変更</button>
                        </div>

                        <div class="control-buttons">
                            <button class="btn btn-primary" id="startStopBtn" onclick="toggleServerState()" disabled>起動</button>
                            <button class="btn btn-secondary" onclick="restartServer()" disabled id="restartBtn">再起動</button>
                        </div>

                        <div class="server-actions">
                            <button class="btn btn-secondary" onclick="viewServerMods()">Mods</button>
                            <button class="btn btn-secondary" onclick="viewServerPlugins()">Plugins</button>
                            <button class="btn btn-secondary" onclick="viewOtherFiles()">その他</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SETTINGS Tab -->
        <div class="tab-content" id="settings-tab">
            <div class="settings-content">
                <h2>サーバー設定</h2>

                <div class="server-list">
                    <div class="server-list-header">
                        <h3>登録済みサーバー</h3>
                        <button class="btn btn-primary" onclick="addNewServerFolder()">
                            <span class="add-icon">⊕</span> フォルダ追加
                        </button>
                    </div>

                    <div class="server-cards" id="serverSettingsCards">
                        <!-- サーバー設定カードがここに表示される -->
                    </div>
                </div>
            </div>

            <!-- サーバー追加/編集モーダル -->
            <div id="serverConfigModal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="configModalTitle">新しいサーバーを追加</h3>
                        <button class="modal-close" onclick="closeServerConfigModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="serverConfigForm">
                            <div class="form-group">
                                <label for="serverName">サーバー名</label>
                                <input type="text" id="serverName" required>
                            </div>

                            <div class="form-group">
                                <label for="serverType">サーバータイプ</label>
                                <select id="serverType" required>
                                    <option value="">選択してください</option>
                                    <option value="velocity">Velocity</option>
                                    <option value="bungeecord">BungeeCord</option>
                                    <option value="fabric">Fabric</option>
                                    <option value="forge">Forge</option>
                                    <option value="paper">Paper</option>
                                    <option value="spigot">Spigot</option>
                                    <option value="vanilla">Vanilla</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="serverHost">ホストアドレス</label>
                                <input type="text" id="serverHost" placeholder="192.168.1.100" required>
                            </div>

                            <div class="form-group">
                                <label for="serverPort">SSHポート</label>
                                <input type="number" id="serverPort" value="22" required>
                            </div>

                            <div class="form-group">
                                <label for="serverUsername">ユーザー名</label>
                                <input type="text" id="serverUsername" placeholder="minecraft" required>
                            </div>

                            <div class="form-group">
                                <label for="serverPath">サーバーフォルダパス</label>
                                <input type="text" id="serverPath" placeholder="/home/minecraft/server" required>
                            </div>

                            <div class="form-group">
                                <label for="privateKeyPath">SSH秘密鍵パス</label>
                                <input type="text" id="privateKeyPath" placeholder="./keys/server_key" required>
                            </div>

                            <div class="startup-file-section">
                                <label>起動ファイル設定</label>
                                <div class="startup-file-display">
                                    <span id="modalSelectedStartupFile">未選択</span>
                                    <button type="button" class="btn btn-secondary" onclick="selectStartupFileForModal()">ファイル選択</button>
                                </div>
                                <small class="form-help">サーバーの起動に使用するJARファイルまたは実行ファイルを選択してください</small>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" onclick="saveServerConfig()">保存</button>
                        <button type="button" class="btn btn-secondary" onclick="closeServerConfigModal()">キャンセル</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ACCOUNT Tab -->
        <div class="tab-content" id="account-tab">
            <div class="account-content">
                <!-- ログイン前 -->
                <div class="login-section" id="loginSection">
                    <div class="login-card">
                        <h2>ログインが必要です</h2>
                        <p>サーバーコンソールを使用するには、Discordアカウントでログインしてください。</p>
                        <button class="btn btn-discord" onclick="loginWithDiscord()">
                            <span class="discord-icon">🎮</span> Discordでログイン
                        </button>
                    </div>
                </div>

                <!-- ログイン後 -->
                <div class="user-info-section hidden" id="userInfoSection">
                    <div class="user-info-card">
                        <div class="user-avatar">
                            <div class="avatar-placeholder" id="userAvatar">👤</div>
                        </div>
                        <div class="user-details">
                            <h3 id="userName">ユーザー名</h3>
                            <p class="user-role" id="userRole">権限: 一般</p>
                        </div>
                        <button class="btn btn-secondary" onclick="logout()">ログアウト</button>
                    </div>

                    <!-- 権限別表示 -->
                    <div class="permission-info">
                        <div id="normalPermission" class="permission-card">
                            <div class="permission-warning">
                                <h3>⚠️ 権限が不足しています</h3>
                                <p>現在、一般ユーザー権限でログインしています。サーバー管理機能を使用するには、管理者に権限の変更を依頼してください。</p>
                                <button class="btn btn-primary" onclick="requestPermission()">権限を要求</button>
                            </div>
                        </div>

                        <div id="memberPermission" class="permission-card hidden">
                            <h3>📖 メンバー権限</h3>
                            <ul>
                                <li>✅ サーバー状態の確認</li>
                                <li>✅ ファイルの閲覧</li>
                                <li>✅ コンソールの確認</li>
                                <li>❌ サーバーの起動・停止</li>
                                <li>❌ ファイルの編集</li>
                                <li>❌設定の変更</li>
                            </ul>
                        </div>

                        <div id="adminPermission" class="permission-card hidden">
                            <h3>👑 管理者権限</h3>
                            <ul>
                                <li>✅ 全ての機能が利用可能</li>
                                <li>✅ サーバーの完全制御</li>
                                <li>✅ ファイルの編集・削除</li>
                                <li>✅ 設定の変更</li>
                                <li>✅ ユーザー権限の管理</li>
                            </ul>

                            <div class="user-management">
                                <h4>ユーザー管理</h4>
                                <div id="userList">
                                    <!-- ユーザー一覧がここに表示される -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="app.js"></script>
</body>
</html>
